From 20be56342f198cc17119fe58d86bce8b6c1b30e4 Mon Sep 17 00:00:00 2001
From: Romain Pokrzywka <romain.pokrzywka@kdab.com>
Date: Sun, 15 Jan 2012 23:53:01 -0600
Subject: Fix build with QT_NO_CURSOR defined

---
 src/plugins/platforms/fb_base/fb_base.cpp          |    5 +++++
 .../platforms/linuxfb/qlinuxfbintegration.cpp      |    2 ++
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/src/plugins/platforms/fb_base/fb_base.cpp b/src/plugins/platforms/fb_base/fb_base.cpp
index 389dfe5..5f71d36 100644
--- a/src/plugins/platforms/fb_base/fb_base.cpp
+++ b/src/plugins/platforms/fb_base/fb_base.cpp
@@ -119,6 +119,10 @@ void QPlatformSoftwareCursor::setCursor(const uchar *data, const uchar *mask, in
 
 void QPlatformSoftwareCursor::changeCursor(QCursor * widgetCursor, QWidget * widget)
 {
+#ifdef QT_NO_CURSOR
+    Q_UNUSED(widgetCursor);
+    Q_UNUSED(widget);
+#else
     Q_UNUSED(widget);
     Qt::CursorShape shape = widgetCursor->shape();
 
@@ -134,6 +138,7 @@ void QPlatformSoftwareCursor::changeCursor(QCursor * widgetCursor, QWidget * wid
     QPoint screenOffset = screen->geometry().topLeft(); // global to local translation
     if (onScreen || screen->geometry().intersects(currentRect.translated(screenOffset)))
         setDirty();
+#endif
 }
 
 QFbScreen::QFbScreen() : cursor(0), mGeometry(), mDepth(16), mFormat(QImage::Format_RGB16), mScreenImage(0), compositePainter(0), isUpToDate(false)
diff --git a/src/plugins/platforms/linuxfb/qlinuxfbintegration.cpp b/src/plugins/platforms/linuxfb/qlinuxfbintegration.cpp
index 306f1c7..64b1a2e 100644
--- a/src/plugins/platforms/linuxfb/qlinuxfbintegration.cpp
+++ b/src/plugins/platforms/linuxfb/qlinuxfbintegration.cpp
@@ -827,7 +827,9 @@ QLinuxFbScreen::QLinuxFbScreen(uchar * d, int w,
                               mFormat);
     mFbScreenImage = new QImage(data, mGeometry.width(), mGeometry.height(),
                               bytesPerLine, mFormat);
+#ifndef QT_NO_CURSOR
     cursor = new QPlatformSoftwareCursor(this);
+#endif
 }
 
 void QLinuxFbScreen::setGeometry(QRect rect)
-- 
1.7.4.1

